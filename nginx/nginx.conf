events {
}

http {
   server {
      listen 80 default_server;
      server_name _;

      location ~ /(?<myhost>[^/]+)(/(?<myuri>.*))? {
         resolver 127.0.0.11 ipv6=off;

         set $target http://$myhost:80/$myuri?$query_string;

         proxy_set_header Host $myhost;
         proxy_set_header X-Real-IP $remote_addr;
         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
         proxy_pass $target;
      }
   }
}