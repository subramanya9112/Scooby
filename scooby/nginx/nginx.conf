events {
}

http {
   server {
      listen 443 ssl;
      server_name _;

      ssl_certificate           /etc/nginx/cert.crt;
      ssl_certificate_key       /etc/nginx/cert.key;

      location ~ /(?<myhost>[^/]+)(/(?<myuri>.*))? {
         resolver 127.0.0.11 ipv6=off;

         set $target http://$myhost:80/$myuri?$query_string;

         proxy_set_header Host $myhost;
         proxy_set_header X-Real-IP $remote_addr;
         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
         proxy_pass $target;
      }
   }
} 